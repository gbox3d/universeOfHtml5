<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<title> flicker app demo 1 </title>

		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />

		<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

		<script>
			$(document).bind('mobileinit', function(evt) {
				//리프레쉬버튼을 눌렀을때 시작 페이지로 페이지 초기화를 한다.
				var strTokens = location.href.split('#');
				console.log('size : ' + strTokens.length);
				if (strTokens.length >= 2) {
					location.href = strTokens[0];
					console.log('current page : #' + strTokens[1]);
					console.log('reset startup page');
					return false;
				}
				//$.mobile 관련 전역변수 초기화는 여기서한다.
				$.mobile.autoInitializePage = false;
				console.log('mobile init');
			});
		</script>

		<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>

		<!-- 자바스크립트는 는 여기에... -->
		<script>
			$(function() {
				//페이지 관련 이밴트는 여기서 초기화
				$.mobile.initializePage();


				
				//도규먼트 객체 관련 이밴트 초기화는 여기서...
				
				$('#img_list').bind('click', function(event) {

						//부모중 첫번째 li얻기
						var parents = $(event.target).parents('li');
						var data = $(parents[0]).data('myapp-detail');
						$('#imgv_page').data('myapp-detail',data);
						
				});
					
				$('#imgv_page').bind('pagebeforeshow', function(event) {
					var dtdata = $(this).data('myapp-detail');
					//console.log(dtdata);
					var img_url = dtdata.media.m;
					var detail_text = dtdata.description;
					$(this).find(':jqmData(role="content") > img').attr('src', img_url);
					$(this).find(':jqmData(role="content") p:eq(0)').html(detail_text);
				  
				});
					
				//ajax 가동
				(function() {
					var url = 'http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?';
					//load 시작
					$.mobile.showPageLoadingMsg();

					//리스트아이템 클릭 이밴트 처리

					//데이터를 jsonp 로 얻어온다.
					$.getJSON(url, {
						tags : "gun",
						tagmode : "any",
						format : "json"
					}, function(data) {//데이터 받기 성공
						
						
						$.each(data.items, function(index, item) {
							$('<img/>').attr('src', item.media.m).text(item.title)
								.appendTo($('<a></a>').text(item.title).attr('href','#imgv_page')
									.appendTo($('<li></li>').data('myapp-detail', item)
										.appendTo('#img_list')
									)
								);
						});

						$('#img_list').listview('refresh');
						
						$.mobile.hidePageLoadingMsg();
						
					}, function(error) {//실패
						$.mobile.hidePageLoadingMsg();
						console.log(JSON.stringify(error));
					});
				})();
				
			});
		</script>
	</head>
	<!-- HTML 태그들은 여기에... -->
	<body>
		<div data-role='page' >
			<div data-role='header' data-position='fixed'>
				<h1> Gun flicker v2.0 </h1>
			</div>
			<div data-role='content'>

				<ul data-role='listview' id='img_list' >
				</ul>
				
			</div>
			<div data-role='footer' data-position='fixed'>
				<h1> (c) GOORUME 2012 </h1>
			</div>
		</div>

		<!---이미지 뷰---->
		<div data-role='page' id='imgv_page' data-add-back-btn='true'>
			<div data-role='header'>
				<h1> 내용보기 </h1>
			</div>
			<div data-role='content'>
				<p>
					
				</p>
				<img />
			</div>
		</div>
		<!-----이미지뷰 끝----------->

	</body>
</html>
