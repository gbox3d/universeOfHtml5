<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />

        <title> flicker app demo 1 </title>

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />

        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

        <script>
            $(document).bind('mobileinit', function(evt) {
                //리프레쉬버튼을 눌렀을때 시작 페이지로 페이지 초기화를 한다.
                var strTokens = location.href.split('#');
                console.log('size : ' + strTokens.length);
                if (strTokens.length >= 2) {
                    location.href = strTokens[0];
                    console.log('current page : #' + strTokens[1]);
                    console.log('reset startup page');
                    return false;
                }
                //$.mobile 관련 전역변수 초기화는 여기서한다.
                $.mobile.autoInitializePage = false;
                console.log('mobile init');
            });
        </script>

        <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>

        <!-- 자바스크립트는 는 여기에... -->
        <script>
            $(function() {
                //페이지 관련 이밴트는 여기서 초기화
                $.mobile.initializePage();

                //도규먼트 객체 관련 이밴트 초기화는 여기서...
                $(':jqmData(role="content") :jqmData(role="button")').bind('click', function(event) {

                    var url = 'http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?';
                    //load 시작
                    $.mobile.showPageLoadingMsg();

                    //리스트아이템 클릭 이밴트 처리

                    $('#img_list').bind('click', function(event) {

                        var parents = $(event.target).parents('li');
                        console.log(parents);

                        var data = $(parents[0]).data('myapp-detail');
                        console.log(data);
                        var img_url = data.media.m;
                        var detail_text = data.description;
                        $('#imgv_page :jqmData(role="content") > img').attr('src', img_url);
                        $('#imgv_page :jqmData(role="content") p:eq(0)').html(detail_text);
                        $.mobile.changePage('#imgv_page', {
                            transition: 'flip',
                            reverse: false,
                            changeHash: true
                        });

                    });

                    //ajax로 이미지 얻어오기

                    $.getJSON(url, {
                        tags: "gun",
                        tagmode: "any",
                        format: "json"
                    }, function(data) {//데이터 받기 성공
                        $.mobile.hidePageLoadingMsg();
                        var log = $(':jqmData(role="page") p:eq(0)');

                        console.log(data);
                        log[0].innerHTML += 'success get data <br/>';
                        log[0].innerHTML += data.items[0].media.m;

                        $.each(data.items, function(index, item) {
                            //log[0].innerHTML += item.title + '<br/>';
                            $('<img/>').attr('src', item.media.m).text(item.title)
                                    .appendTo($('<a></a>').text(item.title)
                                    .appendTo($('<li></li>').data('myapp-detail', item)
                                    .appendTo('#img_list')
                                    )
                                    );

                            //$('<li><a><img src="' + item.media.m + '"/> ' + item.title + '</a></li>').appendTo('#img_list');

                        });

                        $('#img_list').listview('refresh');

                    }, function(error) {//실패
                        $.mobile.hidePageLoadingMsg();
                        console.log(JSON.stringify(error));
                    });

                });
                /*
                 http://api.flickr.com/services/feeds/photos_public.gne?
                 jsoncallback=?tags=cat&format=json&tagmode=any
                 */

            });
        </script>
    </head>
    <!-- HTML 태그들은 여기에... -->
    <body>
        <div data-role='page' >
            <div data-role='header' data-position='fixed'>
                <h1> 안녕하세요 </h1>
            </div>
            <div data-role='content'>

                <div>
                    <ul data-role='listview' id='img_list' >

                    </ul>
                </div>

                <div class='ui-grid-solo ui-bar-e' >
                    <div class="ui-block-a" style="height:40px;">

                    </div>
                    <div class="ui-block-a">
                        <a data-role='button'> get images </a>
                    </div>
                    <div class="ui-block-a">
                        <p></p>
                    </div>

                </div>

            </div>
            <div data-role='footer' data-position='fixed'>
                <h1> 정보영상진흥원 </h1>
            </div>
        </div>

        <!---이미지 뷰---->
        <div data-role='page' id='imgv_page' data-add-back-btn='true'>
            <div data-role='header'>
                <h1> 내용보기 </h1>
            </div>
            <div data-role='content'>
                <p>
                    나무가 죽었네요....
                </p>
                <img src='http://ukga.web-bi.net/img/vyb9.jpeg'>
            </div>
        </div>
        <!-----이미지뷰 끝----------->

    </body>
</html>
