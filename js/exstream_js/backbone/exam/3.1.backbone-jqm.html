<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8" />

        <title>iqm simple sample</title>

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="../lib/std-jqm/css/themes/default/jquery.mobile-1.2.0.css" />

        <script src="../lib/std-jqm/js/jquery.js"></script>


        <script src="../lib/backbone/json2.js"></script>
        <script src="../lib/backbone/underscore.js"></script>
        <script src="../lib/backbone/backbone.js"></script>

        <script>

            $(document).bind('mobileinit', function(evt) {
                //$.mobile 관련 전역변수 초기화는 여기서한다.
                $.mobile.autoInitializePage = false;
                console.log('mobile init');

            });

        </script>

        <script src="../lib/std-jqm//js/jquery.mobile-1.2.0.js"></script>

        <script type="text/javascript">

            $(function() {

                //페이지 초기화 이전작업은 여기서 코딩해준다..

                // 페이지 초기화 관련 pageinit 메쎄지가 처리된다.
                $.mobile.initializePage();

                //페이지 초기화 이후작업 여기에 코딩해준다.

                //모델 정의
                var Item = Backbone.Model.extend({
                    defaults: {
                        img_url: '',
                        text: ''
                    },
                    initialize: function() {
                        console.log(this.get('text'));
                    }
                });

                //콜랙터 정의
                var List = Backbone.Collection.extend({
                    model: Item
                });

//뷰정의
                var ItemView = Backbone.View.extend({
                    tagName: 'li',
                    initialize: function() {
                        _.bindAll(this, 'render');

                    },
                    render: function() {
                        //this.$el.html('<a>' + this.model.get('text') + '</a>');
                        $(this.el).append(
                                $('<a></a>').text(this.model.get('text'))
                                .append($('<img/>').attr('src', this.model.get('img_url')))
                                );
                        return this;
                    }

                });

                var ListView = Backbone.View.extend({
                    //el: $('#img_list'),
                    el: $(':jqmData(role="content")'),
                    initialize: function(param) {
                        _.bindAll(this, 'render');
                        this.collection = new List(
                                param.listdata
                                );
                        this.render();

                    },
                    render: function() {
                
                        $(this.el).append($("<ul></ul>").attr('data-role', 'listview'));
                        $('ul', this.el).listview();

                        var self = this;
                        _(this.collection.models).each(function(item) {
                            var itemview = new ItemView({
                                model: item
                            });
                            $('ul', self.el).append(itemview.render().el);

                        });
                        
                        $('ul', this.el).listview('refresh');
                    }

                });

                var listView = new ListView({listdata: [
                        {img_url: "http://ukga.web-bi.net/img/vyb9.jpeg", text: "희망이 죽었네..."},
                        {img_url: "http://ukga.web-bi.net/img/gk.png", text: "주인조차 못푸는..."},
                        {img_url: "http://ukga.web-bi.net/img/zao5.jpeg", text: "미국은 머든지 크죠..."}
                    ]});




            });

        </script>

    </head>

    <body>
        <div data-role="page" id="main-page">
            <div data-role="header" data-position="fixed"  data-theme='a'>
                <h1>Home</h1>
            </div><!-- /header -->

            <div data-role='content' >
               
            </div><!-- /content -->

            <div data-role='footer' data-position="fixed" >
                <h1>&copy; 2011-12 goorume</h1>
            </div><!-- /footer -->
        </div>

    </body>
</html>